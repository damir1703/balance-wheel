<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ĞšĞ¾Ğ»ĞµÑĞ¾ Ğ‘Ğ°Ğ»Ğ°Ğ½ÑĞ°</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  :root {
    --bg: #0a0a0a;
    --card: #1a1a1a;
    --card-2: #222222;
    --accent: #e63946;
    --accent-dim: rgba(230, 57, 70, 0.15);
    --text: #ffffff;
    --text-secondary: #888888;
    --border: rgba(255,255,255,0.07);
    --radius: 14px;
    --radius-sm: 8px;
  }

  html, body {
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 14px;
    line-height: 1.5;
    overflow-x: hidden;
  }

  /* â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .app {
    display: flex;
    min-height: 100vh;
  }

  /* LEFT PANEL */
  .left-panel {
    width: 40%;
    min-width: 320px;
    background: var(--card);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    padding: 32px 28px 100px;
    overflow-y: auto;
    position: relative;
  }

  /* RIGHT PANEL */
  .right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 32px 28px 32px;
    overflow-y: auto;
  }

  /* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .header {
    margin-bottom: 28px;
  }

  .header-label {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: var(--accent-dim);
    border: 1px solid rgba(230, 57, 70, 0.3);
    color: var(--accent);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 100px;
    margin-bottom: 12px;
  }

  .header-label::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--accent);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .header h1 {
    font-size: clamp(20px, 3vw, 28px);
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1.2;
    margin-bottom: 6px;
  }

  .header h1 span {
    color: var(--accent);
  }

  .header p {
    color: var(--text-secondary);
    font-size: 13px;
    line-height: 1.6;
  }

  /* â”€â”€â”€ CATEGORIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .categories {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 24px;
  }

  .category-item {
    background: var(--card-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px 14px;
    transition: border-color 0.2s;
  }

  .category-item:hover {
    border-color: rgba(230, 57, 70, 0.3);
  }

  .category-top {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
  }

  .category-emoji {
    font-size: 16px;
    line-height: 1;
    flex-shrink: 0;
  }

  .category-name {
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
    flex: 1;
  }

  .category-controls {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* Slider */
  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    flex: 1;
    height: 4px;
    background: rgba(255,255,255,0.1);
    border-radius: 100px;
    outline: none;
    cursor: pointer;
    position: relative;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.2);
    transition: box-shadow 0.2s, transform 0.15s;
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    box-shadow: 0 0 0 5px rgba(230, 57, 70, 0.25);
    transform: scale(1.1);
  }

  input[type="range"]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: none;
    box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.2);
  }

  input[type="range"]::-moz-range-track {
    height: 4px;
    background: rgba(255,255,255,0.1);
    border-radius: 100px;
  }

  /* Number input */
  .num-input {
    width: 44px;
    height: 36px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text);
    font-family: inherit;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    outline: none;
    cursor: text;
    transition: border-color 0.2s;
    -moz-appearance: textfield;
  }

  .num-input::-webkit-outer-spin-button,
  .num-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
  }

  .num-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(230, 57, 70, 0.15);
  }

  /* â”€â”€â”€ STATS CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stats-card {
    background: linear-gradient(135deg, rgba(230,57,70,0.1) 0%, rgba(230,57,70,0.03) 100%);
    border: 1px solid rgba(230, 57, 70, 0.25);
    border-radius: var(--radius);
    padding: 16px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .stats-label {
    color: var(--text-secondary);
    font-size: 13px;
  }

  .stats-value {
    font-size: 28px;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: -0.03em;
  }

  .stats-value span {
    font-size: 14px;
    font-weight: 400;
    color: var(--text-secondary);
  }

  /* â”€â”€â”€ PDF BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .btn-pdf {
    width: 100%;
    padding: 14px;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    font-family: inherit;
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.02em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
    box-shadow: 0 4px 20px rgba(230, 57, 70, 0.3);
  }

  .btn-pdf:hover {
    background: #c1121f;
    box-shadow: 0 6px 28px rgba(230, 57, 70, 0.45);
    transform: translateY(-1px);
  }

  .btn-pdf:active {
    transform: translateY(0);
  }

  .btn-pdf.loading {
    opacity: 0.7;
    pointer-events: none;
  }

  /* â”€â”€â”€ RIGHT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .chart-header {
    width: 100%;
    max-width: 560px;
    margin-bottom: 20px;
    text-align: center;
  }

  .chart-title {
    font-size: clamp(16px, 2.5vw, 20px);
    font-weight: 600;
    margin-bottom: 4px;
  }

  .chart-subtitle {
    color: var(--text-secondary);
    font-size: 13px;
  }

  .canvas-wrap {
    width: 100%;
    max-width: 520px;
    aspect-ratio: 1;
    position: relative;
  }

  #radar {
    width: 100%;
    height: 100%;
    display: block;
  }

  /* â”€â”€â”€ INSIGHT CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .insights {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    width: 100%;
    max-width: 520px;
    margin-top: 20px;
  }

  .insight-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 12px;
    text-align: center;
    transition: border-color 0.2s;
  }

  .insight-card:hover {
    border-color: rgba(230, 57, 70, 0.3);
  }

  .insight-icon {
    font-size: 20px;
    margin-bottom: 6px;
  }

  .insight-label {
    color: var(--text-secondary);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-bottom: 4px;
  }

  .insight-value {
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.2;
  }

  .insight-sub {
    font-size: 11px;
    color: var(--text-secondary);
    margin-top: 2px;
  }

  /* â”€â”€â”€ SCROLLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

  /* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (min-width: 768px) and (max-width: 1023px) {
    .left-panel { width: 45%; padding: 24px 20px 90px; }
    .right-panel { padding: 24px 16px; }
    .insights { grid-template-columns: repeat(3, 1fr); }
  }

  @media (max-width: 767px) {
    .app {
      flex-direction: column;
    }

    .left-panel {
      width: 100%;
      min-width: unset;
      border-right: none;
      border-bottom: 1px solid var(--border);
      padding: 20px 16px 96px;
    }

    .right-panel {
      padding: 20px 16px 24px;
    }

    .category-name {
      font-size: 14px;
    }

    .category-item {
      padding: 10px 12px;
    }

    input[type="range"] {
      height: 6px;
    }

    input[type="range"]::-webkit-slider-thumb {
      width: 22px;
      height: 22px;
    }

    input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
    }

    .num-input {
      width: 48px;
      height: 44px;
      font-size: 15px;
    }

    .canvas-wrap {
      max-width: 90vw;
    }

    .insights {
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .insight-card {
      padding: 10px 8px;
    }

    .insight-icon { font-size: 18px; }
    .insight-value { font-size: 13px; }

    /* Fixed PDF button on mobile */
    .btn-pdf-wrap {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 12px 16px;
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
      background: linear-gradient(to top, #0a0a0a 60%, transparent);
      z-index: 100;
    }
  }

  @media (max-width: 400px) {
    .insights {
      grid-template-columns: 1fr;
    }
  }

  /* â”€â”€â”€ SLIDER FILL TRICK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  input[type="range"] {
    background: linear-gradient(
      to right,
      var(--accent) 0%,
      var(--accent) var(--val, 40%),
      rgba(255,255,255,0.1) var(--val, 40%),
      rgba(255,255,255,0.1) 100%
    );
  }
</style>
</head>
<body>

<div class="app" id="app">

  <!-- â•â•â•â•â•â•â•â•â•â•â• LEFT PANEL â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="left-panel" id="leftPanel">

    <div class="header">
      <div class="header-label">ĞšĞ¾ÑƒÑ‡Ğ¸Ğ½Ğ³-Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚</div>
      <h1>ĞšĞ¾Ğ»ĞµÑĞ¾ <span>Ğ‘Ğ°Ğ»Ğ°Ğ½ÑĞ°</span></h1>
      <p>ĞÑ†ĞµĞ½Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¶Ğ´ÑƒÑ ÑÑ„ĞµÑ€Ñƒ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ğ¾Ñ‚ 1 Ğ´Ğ¾ 10 Ğ¸ ÑƒĞ²Ğ¸Ğ´ÑŒÑ‚Ğµ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ñƒ ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°</p>
    </div>

    <div class="categories" id="categories">
      <!-- dynamically rendered -->
    </div>

    <div class="stats-card">
      <div>
        <div class="stats-label">Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ»</div>
        <div style="color: var(--text-secondary); font-size: 11px; margin-top: 2px;">Ğ¿Ğ¾ Ğ²ÑĞµĞ¼ ÑÑ„ĞµÑ€Ğ°Ğ¼</div>
      </div>
      <div>
        <div class="stats-value" id="avgScore">5.0<span>/10</span></div>
      </div>
    </div>

    <div class="btn-pdf-wrap">
      <button class="btn-pdf" id="btnPdf" onclick="exportPDF()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ PDF
      </button>
    </div>

  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• RIGHT PANEL â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="right-panel" id="rightPanel">

    <div class="chart-header">
      <div class="chart-title">Ğ Ğ°Ğ´Ğ°Ñ€ Ğ‘Ğ°Ğ»Ğ°Ğ½ÑĞ°</div>
      <div class="chart-subtitle">Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ ÑÑ„ĞµÑ€Ğ°Ğ¼ Ğ¶Ğ¸Ğ·Ğ½Ğ¸</div>
    </div>

    <div class="canvas-wrap" id="canvasWrap">
      <canvas id="radar"></canvas>
    </div>

    <div class="insights" id="insights">
      <div class="insight-card">
        <div class="insight-icon">ğŸ†</div>
        <div class="insight-label">Ğ¡Ğ¸Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞ°Ñ</div>
        <div class="insight-value" id="insightStrong">â€”</div>
        <div class="insight-sub" id="insightStrongScore"></div>
      </div>
      <div class="insight-card">
        <div class="insight-icon">âš ï¸</div>
        <div class="insight-label">Ğ—Ğ¾Ğ½Ğ° Ñ€Ğ¾ÑÑ‚Ğ°</div>
        <div class="insight-value" id="insightWeak">â€”</div>
        <div class="insight-sub" id="insightWeakScore"></div>
      </div>
      <div class="insight-card">
        <div class="insight-icon">ğŸ“Š</div>
        <div class="insight-label">Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ</div>
        <div class="insight-value" id="insightBalance">â€”</div>
        <div class="insight-sub">Ñ€Ğ°Ğ²Ğ½Ğ¾Ğ¼ĞµÑ€Ğ½Ğ¾ÑÑ‚ÑŒ</div>
      </div>
    </div>

  </div>

</div>

<script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CATEGORIES = [
  { id: 'career',    emoji: 'ğŸ’¼', name: 'ĞšĞ°Ñ€ÑŒĞµÑ€Ğ° Ğ¸ Ğ‘Ğ¸Ğ·Ğ½ĞµÑ' },
  { id: 'finance',   emoji: 'ğŸ’°', name: 'Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑÑ‹' },
  { id: 'relations', emoji: 'â¤ï¸', name: 'ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ' },
  { id: 'health',    emoji: 'ğŸ‹ï¸', name: 'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ Ğ¸ Ğ¡Ğ¿Ğ¾Ñ€Ñ‚' },
  { id: 'growth',    emoji: 'ğŸ¯', name: 'Ğ›Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ½Ñ‹Ğ¹ Ñ€Ğ¾ÑÑ‚' },
  { id: 'rest',      emoji: 'ğŸ‰', name: 'ĞÑ‚Ğ´Ñ‹Ñ… Ğ¸ Ğ¥Ğ¾Ğ±Ğ±Ğ¸' },
  { id: 'family',    emoji: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', name: 'Ğ¡ĞµĞ¼ÑŒÑ' },
  { id: 'social',    emoji: 'ğŸŒ', name: 'ĞĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ”Ñ€ÑƒĞ·ÑŒÑ' },
];

const LS_KEY = 'wheel_balance_v1';

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let values = {};
let animTarget = {};
let animCurrent = {};
let animFrame = null;

function loadValues() {
  const defaults = {};
  CATEGORIES.forEach(c => defaults[c.id] = 5);
  try {
    const saved = localStorage.getItem(LS_KEY);
    if (saved) {
      const parsed = JSON.parse(saved);
      CATEGORIES.forEach(c => {
        const v = parseInt(parsed[c.id]);
        defaults[c.id] = (!isNaN(v) && v >= 1 && v <= 10) ? v : 5;
      });
    }
  } catch(e) {}
  return defaults;
}

function saveValues() {
  try {
    localStorage.setItem(LS_KEY, JSON.stringify(values));
  } catch(e) {}
}

// â”€â”€â”€ RENDER FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildForm() {
  const container = document.getElementById('categories');
  container.innerHTML = '';

  CATEGORIES.forEach(cat => {
    const val = values[cat.id];
    const pct = ((val - 1) / 9 * 100).toFixed(1);

    const item = document.createElement('div');
    item.className = 'category-item';
    item.innerHTML = `
      <div class="category-top">
        <span class="category-emoji">${cat.emoji}</span>
        <span class="category-name">${cat.name}</span>
      </div>
      <div class="category-controls">
        <input
          type="range"
          min="1" max="10" step="1"
          value="${val}"
          style="--val: ${pct}%"
          data-id="${cat.id}"
          class="slider"
          aria-label="${cat.name}"
        >
        <input
          type="number"
          min="1" max="10"
          value="${val}"
          data-id="${cat.id}"
          class="num-input"
          aria-label="${cat.name} Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ"
        >
      </div>
    `;
    container.appendChild(item);
  });

  // Bind events
  container.querySelectorAll('.slider').forEach(slider => {
    slider.addEventListener('input', () => {
      const id = slider.dataset.id;
      const v = parseInt(slider.value);
      updateValue(id, v, 'slider');
    });
  });

  container.querySelectorAll('.num-input').forEach(input => {
    input.addEventListener('input', () => {
      const id = input.dataset.id;
      let v = parseInt(input.value);
      if (isNaN(v)) return;
      v = Math.max(1, Math.min(10, v));
      updateValue(id, v, 'input');
    });
    input.addEventListener('blur', () => {
      const id = input.dataset.id;
      let v = parseInt(input.value);
      if (isNaN(v) || v < 1) v = 1;
      if (v > 10) v = 10;
      input.value = v;
      updateValue(id, v, 'input');
    });
    input.addEventListener('keydown', e => {
      if (e.key === 'ArrowUp') {
        e.preventDefault();
        const id = input.dataset.id;
        const newV = Math.min(10, values[id] + 1);
        updateValue(id, newV, 'input');
      }
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        const id = input.dataset.id;
        const newV = Math.max(1, values[id] - 1);
        updateValue(id, newV, 'input');
      }
    });
  });
}

function updateValue(id, v, source) {
  values[id] = v;
  saveValues();

  // Sync controls
  const pct = ((v - 1) / 9 * 100).toFixed(1);
  if (source !== 'slider') {
    const slider = document.querySelector(`.slider[data-id="${id}"]`);
    if (slider) { slider.value = v; slider.style.setProperty('--val', pct + '%'); }
  } else {
    const slider = document.querySelector(`.slider[data-id="${id}"]`);
    if (slider) slider.style.setProperty('--val', pct + '%');
  }
  if (source !== 'input') {
    const input = document.querySelector(`.num-input[data-id="${id}"]`);
    if (input) input.value = v;
  }

  updateStats();
  scheduleAnimation();
}

// â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats() {
  const vals = CATEGORIES.map(c => values[c.id]);
  const avg = vals.reduce((a, b) => a + b, 0) / vals.length;
  document.getElementById('avgScore').innerHTML = avg.toFixed(1) + '<span>/10</span>';

  const maxV = Math.max(...vals);
  const minV = Math.min(...vals);
  const maxCat = CATEGORIES[vals.indexOf(maxV)];
  const minCat = CATEGORIES[vals.indexOf(minV)];

  document.getElementById('insightStrong').textContent = maxCat.name.split(' ')[0];
  document.getElementById('insightStrongScore').textContent = `${maxCat.emoji} ${maxV}/10`;

  document.getElementById('insightWeak').textContent = minCat.name.split(' ')[0];
  document.getElementById('insightWeakScore').textContent = `${minCat.emoji} ${minV}/10`;

  // Balance score: 100% = all equal, lower = more uneven
  const mean = avg;
  const variance = vals.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / vals.length;
  const stdDev = Math.sqrt(variance);
  const balanceScore = Math.max(0, Math.round((1 - stdDev / 4.5) * 100));
  document.getElementById('insightBalance').textContent = balanceScore + '%';
}

// â”€â”€â”€ CANVAS / RADAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas = document.getElementById('radar');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  const wrap = document.getElementById('canvasWrap');
  const size = wrap.clientWidth;
  const dpr = window.devicePixelRatio || 1;
  canvas.width = size * dpr;
  canvas.height = size * dpr;
  canvas.style.width = size + 'px';
  canvas.style.height = size + 'px';
  ctx.scale(dpr, dpr);
  drawRadar();
}

function scheduleAnimation() {
  CATEGORIES.forEach(c => { animTarget[c.id] = values[c.id]; });
  if (!animFrame) animateRadar();
}

function animateRadar() {
  let allDone = true;
  CATEGORIES.forEach(c => {
    const diff = animTarget[c.id] - animCurrent[c.id];
    if (Math.abs(diff) < 0.02) {
      animCurrent[c.id] = animTarget[c.id];
    } else {
      animCurrent[c.id] += diff * 0.18;
      allDone = false;
    }
  });

  drawRadar();

  if (allDone) {
    animFrame = null;
  } else {
    animFrame = requestAnimationFrame(animateRadar);
  }
}

function drawRadar() {
  const wrap = document.getElementById('canvasWrap');
  const size = wrap.clientWidth;
  const cx = size / 2;
  const cy = size / 2;
  const isMobile = size < 340;
  const labelFontSize = isMobile ? 9 : (size < 420 ? 10 : 12);
  const maxR = size * 0.35;
  const N = CATEGORIES.length;

  ctx.clearRect(0, 0, size, size);

  function angleFor(i) {
    return (Math.PI * 2 * i / N) - Math.PI / 2;
  }

  function polarToXY(r, angle) {
    return { x: cx + r * Math.cos(angle), y: cy + r * Math.sin(angle) };
  }

  // â”€â”€ Grid rings â”€â”€
  const rings = [2, 4, 6, 8, 10];
  rings.forEach(ring => {
    ctx.beginPath();
    for (let i = 0; i <= N; i++) {
      const a = angleFor(i % N);
      const r = (ring / 10) * maxR;
      const p = polarToXY(r, a);
      i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y);
    }
    ctx.closePath();
    ctx.strokeStyle = 'rgba(255,255,255,0.07)';
    ctx.lineWidth = 1;
    ctx.stroke();

    // Ring label
    ctx.fillStyle = 'rgba(255,255,255,0.2)';
    ctx.font = `${labelFontSize - 1}px Inter, sans-serif`;
    ctx.textAlign = 'center';
    ctx.fillText(ring, cx + 4, cy - (ring / 10) * maxR + 3);
  });

  // â”€â”€ Axis lines â”€â”€
  CATEGORIES.forEach((_, i) => {
    const a = angleFor(i);
    const p = polarToXY(maxR, a);
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(p.x, p.y);
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
    ctx.lineWidth = 1;
    ctx.stroke();
  });

  // â”€â”€ Data polygon â”€â”€
  ctx.beginPath();
  CATEGORIES.forEach((cat, i) => {
    const a = angleFor(i);
    const v = animCurrent[cat.id] || values[cat.id];
    const r = (v / 10) * maxR;
    const p = polarToXY(r, a);
    i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y);
  });
  ctx.closePath();
  ctx.fillStyle = 'rgba(230, 57, 70, 0.18)';
  ctx.fill();
  ctx.strokeStyle = '#e63946';
  ctx.lineWidth = 2;
  ctx.lineJoin = 'round';
  ctx.stroke();

  // â”€â”€ Data points â”€â”€
  CATEGORIES.forEach((cat, i) => {
    const a = angleFor(i);
    const v = animCurrent[cat.id] || values[cat.id];
    const r = (v / 10) * maxR;
    const p = polarToXY(r, a);

    ctx.beginPath();
    ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
    ctx.fillStyle = '#e63946';
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 1.5;
    ctx.stroke();
  });

  // â”€â”€ Axis labels â”€â”€
  const labelPad = isMobile ? 18 : 22;
  CATEGORIES.forEach((cat, i) => {
    const a = angleFor(i);
    const p = polarToXY(maxR + labelPad, a);

    ctx.font = `500 ${labelFontSize}px Inter, sans-serif`;
    ctx.fillStyle = 'rgba(255,255,255,0.85)';

    // Align by position
    const eps = 0.05;
    if (Math.cos(a) > eps) ctx.textAlign = 'left';
    else if (Math.cos(a) < -eps) ctx.textAlign = 'right';
    else ctx.textAlign = 'center';

    // Vertical baseline
    if (Math.sin(a) < -eps) ctx.textBaseline = 'bottom';
    else if (Math.sin(a) > eps) ctx.textBaseline = 'top';
    else ctx.textBaseline = 'middle';

    // Draw label: emoji + short name
    const shortName = cat.name.split(' ')[0];
    const label = `${cat.emoji} ${shortName}`;
    ctx.fillText(label, p.x, p.y);
  });
}

// â”€â”€â”€ PDF EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function exportPDF() {
  const btn = document.getElementById('btnPdf');
  btn.classList.add('loading');
  btn.textContent = 'Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ PDF...';

  try {
    // Capture full app
    const appEl = document.getElementById('app');
    const canvas = await html2canvas(appEl, {
      backgroundColor: '#0a0a0a',
      scale: 2,
      useCORS: true,
      logging: false,
    });

    const imgData = canvas.toDataURL('image/png');

    // Build simple PDF manually (no library needed for basic one-page PDF)
    const img = new Image();
    img.onload = () => {
      const pw = 297; // A4 landscape mm
      const ph = 210;
      const iw = img.width;
      const ih = img.height;

      const ratio = Math.min(pw / iw * 3.78, ph / ih * 3.78);
      const fw = iw * ratio;
      const fh = ih * ratio;

      // Open print dialog with image
      const printWin = window.open('', '_blank');
      printWin.document.write(`
        <!DOCTYPE html><html><head>
        <meta charset="UTF-8">
        <title>ĞšĞ¾Ğ»ĞµÑĞ¾ Ğ‘Ğ°Ğ»Ğ°Ğ½ÑĞ°</title>
        <style>
          @page { size: A4 landscape; margin: 0; }
          body { margin: 0; padding: 0; background: #0a0a0a; display:flex; align-items:center; justify-content:center; height:100vh; }
          img { max-width: 100%; max-height: 100vh; object-fit: contain; }
        </style></head>
        <body><img src="${imgData}"></body></html>
      `);
      printWin.document.close();
      printWin.focus();
      setTimeout(() => {
        printWin.print();
        printWin.close();
      }, 500);
    };
    img.src = imgData;

  } catch(e) {
    console.error('PDF export failed:', e);
    alert('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ PDF. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.');
  }

  btn.classList.remove('loading');
  btn.innerHTML = `
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
      <polyline points="7 10 12 15 17 10"/>
      <line x1="12" y1="15" x2="12" y2="3"/>
    </svg>
    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ PDF
  `;
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
  values = loadValues();
  CATEGORIES.forEach(c => {
    animCurrent[c.id] = values[c.id];
    animTarget[c.id] = values[c.id];
  });

  buildForm();
  updateStats();
  resizeCanvas();

  // ResizeObserver for responsive chart
  const ro = new ResizeObserver(() => resizeCanvas());
  ro.observe(document.getElementById('canvasWrap'));
}

// Move PDF button wrap into fixed position on mobile
function checkMobilePdfBtn() {
  const wrap = document.querySelector('.btn-pdf-wrap');
  if (!wrap) return;
  if (window.innerWidth <= 767) {
    if (!document.getElementById('fixedPdfWrap')) {
      const fixed = document.createElement('div');
      fixed.id = 'fixedPdfWrap';
      fixed.className = 'btn-pdf-wrap';
      fixed.style.cssText = `
        position: fixed; bottom: 0; left: 0; right: 0;
        padding: 12px 16px;
        padding-bottom: calc(12px + env(safe-area-inset-bottom));
        background: linear-gradient(to top, #0a0a0a 60%, transparent);
        z-index: 100;
      `;
      fixed.appendChild(document.getElementById('btnPdf').cloneNode(true));
      document.body.appendChild(fixed);
      fixed.querySelector('.btn-pdf').addEventListener('click', exportPDF);
      document.getElementById('btnPdf').style.visibility = 'hidden';
    }
  } else {
    const fixed = document.getElementById('fixedPdfWrap');
    if (fixed) fixed.remove();
    const btn = document.getElementById('btnPdf');
    if (btn) btn.style.visibility = '';
  }
}

window.addEventListener('resize', checkMobilePdfBtn);
document.addEventListener('DOMContentLoaded', () => {
  init();
  checkMobilePdfBtn();
});
</script>
</body>
</html>
